{"ast":null,"code":"var _jsxFileName = \"/Users/chulnamgoong/Documents/front_end/slack/src/components/Modal/ImageModal.jsx\",\n  _s = $RefreshSig$();\nimport { Button, Dialog, DialogActions, DialogContent, DialogTitle, Input } from '@mui/material';\nimport React, { useCallback, useState } from 'react';\nimport { v4 as uuidv4 } from 'uuid';\nimport '../../firebase';\nimport { getDownloadURL, getStorage, ref as ref_storage, uploadBytesResumable } from 'firebase/storage';\nimport { getDatabase, push, ref, serverTimestamp, set } from 'firebase/database';\nimport { useSelector } from 'react-redux';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function ImageModal(_ref) {\n  _s();\n  var _channel$currentChann2;\n  let {\n    open,\n    handleClose\n  } = _ref;\n  const {\n    channel,\n    user\n  } = useSelector(state => state);\n  const [file, setFile] = useState(null);\n  const onChangeAddFile = useCallback(event => {\n    const addedfile = event.target.files[0];\n    if (addedfile) setFile(addedfile);\n  }, []);\n  const createImageMessage = useCallback(fileUrl => ({\n    timestamp: serverTimestamp(),\n    user: {\n      id: user.currentUser.uid,\n      name: user.currentUser.displayName,\n      avatar: user.currentUser.photoURL\n    },\n    image: fileUrl\n  }), [user.currentUser.uid, user.currentUser.displayName, user.currentUser.photoURL]);\n  const uploadFile = useCallback(() => {\n    // TODO uploading 중인지?\n    const filePath = `chat/${uuidv4()}.${file.name.split('.').pop()}`;\n    const uploadTask = uploadBytesResumable(ref_storage(getStorage(), filePath), file);\n    const unsubscribe = uploadTask.on('state_changed', snap => {\n      const percentUploaded = Math.round(snap.bytesTransferred / snap.totalBytes * 100);\n    }, error => {\n      console.error(error);\n    }, async () => {\n      try {\n        var _channel$currentChann;\n        const downloadUrl = await getDownloadURL(uploadTask.snapshot.ref);\n        await set(push(ref(getDatabase(), 'messages/' + ((_channel$currentChann = channel.currentChannel) === null || _channel$currentChann === void 0 ? void 0 : _channel$currentChann.id))), createImageMessage(downloadUrl));\n        unsubscribe();\n      } catch (error) {\n        console.error(error);\n        unsubscribe();\n      }\n    });\n  }, [(_channel$currentChann2 = channel.currentChannel) === null || _channel$currentChann2 === void 0 ? void 0 : _channel$currentChann2.id, createImageMessage, file]);\n  const handleSendFile = useCallback(() => {\n    uploadFile();\n    handleClose();\n    setFile(null);\n  }, [handleClose, uploadFile]);\n  return /*#__PURE__*/_jsxDEV(Dialog, {\n    open: open,\n    onClose: handleClose,\n    children: [/*#__PURE__*/_jsxDEV(DialogTitle, {\n      children: \"\\uC774\\uBBF8\\uC9C0 \\uBCF4\\uB0B4\\uAE30\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 90,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(DialogContent, {\n      children: /*#__PURE__*/_jsxDEV(Input, {\n        margin: \"dense\",\n        inputProps: {\n          accept: 'image/jpeg, image/jpg, image/png, image/gif'\n        },\n        type: \"file\",\n        fullWidth: true,\n        variant: \"standard\",\n        onChange: onChangeAddFile\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 92,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 91,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(DialogActions, {\n      children: [/*#__PURE__*/_jsxDEV(Button, {\n        onClick: handleClose,\n        children: \"\\uCDE8\\uC18C\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 102,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Button, {\n        onClick: handleSendFile,\n        children: \"\\uC804\\uC1A1\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 103,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 101,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 89,\n    columnNumber: 5\n  }, this);\n}\n_s(ImageModal, \"PS6GgBXQ20YmivaUn34hjMeqvog=\", false, function () {\n  return [useSelector];\n});\n_c = ImageModal;\nvar _c;\n$RefreshReg$(_c, \"ImageModal\");","map":{"version":3,"names":["Button","Dialog","DialogActions","DialogContent","DialogTitle","Input","React","useCallback","useState","v4","uuidv4","getDownloadURL","getStorage","ref","ref_storage","uploadBytesResumable","getDatabase","push","serverTimestamp","set","useSelector","jsxDEV","_jsxDEV","ImageModal","_ref","_s","_channel$currentChann2","open","handleClose","channel","user","state","file","setFile","onChangeAddFile","event","addedfile","target","files","createImageMessage","fileUrl","timestamp","id","currentUser","uid","name","displayName","avatar","photoURL","image","uploadFile","filePath","split","pop","uploadTask","unsubscribe","on","snap","percentUploaded","Math","round","bytesTransferred","totalBytes","error","console","_channel$currentChann","downloadUrl","snapshot","currentChannel","handleSendFile","onClose","children","fileName","_jsxFileName","lineNumber","columnNumber","margin","inputProps","accept","type","fullWidth","variant","onChange","onClick","_c","$RefreshReg$"],"sources":["/Users/chulnamgoong/Documents/front_end/slack/src/components/Modal/ImageModal.jsx"],"sourcesContent":["import {\n  Button,\n  Dialog,\n  DialogActions,\n  DialogContent,\n  DialogTitle,\n  Input,\n} from '@mui/material'\nimport React, { useCallback, useState } from 'react'\nimport { v4 as uuidv4 } from 'uuid'\nimport '../../firebase'\nimport {\n  getDownloadURL,\n  getStorage,\n  ref as ref_storage,\n  uploadBytesResumable,\n} from 'firebase/storage'\nimport { getDatabase, push, ref, serverTimestamp, set } from 'firebase/database'\nimport { useSelector } from 'react-redux'\n\nexport default function ImageModal({ open, handleClose }) {\n  const { channel, user } = useSelector(state => state)\n  const [file, setFile] = useState(null)\n\n  const onChangeAddFile = useCallback(event => {\n    const addedfile = event.target.files[0]\n    if (addedfile) setFile(addedfile)\n  }, [])\n\n  const createImageMessage = useCallback(\n    fileUrl => ({\n      timestamp: serverTimestamp(),\n      user: {\n        id: user.currentUser.uid,\n        name: user.currentUser.displayName,\n        avatar: user.currentUser.photoURL,\n      },\n      image: fileUrl,\n    }),\n    [\n      user.currentUser.uid,\n      user.currentUser.displayName,\n      user.currentUser.photoURL,\n    ]\n  )\n\n  const uploadFile = useCallback(() => {\n    // TODO uploading 중인지?\n    const filePath = `chat/${uuidv4()}.${file.name.split('.').pop()}`\n    const uploadTask = uploadBytesResumable(\n      ref_storage(getStorage(), filePath),\n      file\n    )\n    const unsubscribe = uploadTask.on(\n      'state_changed',\n      snap => {\n        const percentUploaded = Math.round(\n          (snap.bytesTransferred / snap.totalBytes) * 100\n        )\n      },\n      error => {\n        console.error(error)\n      },\n      async () => {\n        try {\n          const downloadUrl = await getDownloadURL(uploadTask.snapshot.ref)\n          await set(\n            push(ref(getDatabase(), 'messages/' + channel.currentChannel?.id)),\n            createImageMessage(downloadUrl)\n          )\n\n          unsubscribe()\n        } catch (error) {\n          console.error(error)\n\n          unsubscribe()\n        }\n      }\n    )\n  }, [channel.currentChannel?.id, createImageMessage, file])\n\n  const handleSendFile = useCallback(() => {\n    uploadFile()\n    handleClose()\n    setFile(null)\n  }, [handleClose, uploadFile])\n\n  return (\n    <Dialog open={open} onClose={handleClose}>\n      <DialogTitle>이미지 보내기</DialogTitle>\n      <DialogContent>\n        <Input\n          margin=\"dense\"\n          inputProps={{ accept: 'image/jpeg, image/jpg, image/png, image/gif' }}\n          type=\"file\"\n          fullWidth\n          variant=\"standard\"\n          onChange={onChangeAddFile}\n        />\n      </DialogContent>\n      <DialogActions>\n        <Button onClick={handleClose}>취소</Button>\n        <Button onClick={handleSendFile}>전송</Button>\n      </DialogActions>\n    </Dialog>\n  )\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}